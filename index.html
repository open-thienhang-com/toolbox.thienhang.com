<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Toolbox</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
  body { height: 100vh; }
  #sidebar { height: 100vh; overflow-y: auto; }
  #content { overflow-y: auto; height: 100vh; }
</style>
</head>
<body class="flex">

  <aside id="sidebar" class="w-96 bg-gray-800 text-white flex flex-col p-4">
    <h1 class="text-2xl font-bold mb-4">Toolbox 100 Features</h1>
    <input id="searchInput" type="text" placeholder="Tìm kiếm..." class="mb-4 p-2 rounded text-black" autocomplete="off" />
    <nav id="menu" class="flex-grow overflow-auto">
      <div id="menuList" class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3"></div>
    </nav>
  </aside>

  <main id="content" class="flex-grow p-6 bg-gray-100">
    <iframe
      id="featureFrame"
      name="featureFrame"
      src=""
      class="w-full h-full border rounded"
      frameborder="0"
      title="Feature Content"
    ></iframe>
  </main>

<script>
  const menuList = document.getElementById('menuList');
  const searchInput = document.getElementById('searchInput');
  const totalFeatures = 100; // Tổng số feature
  let allFeatures = [];

  // Hàm fetch file HTML và đọc tiêu đề <h1 class="text-3xl font-bold mb-4">
  async function getFeatureTitle(index) {
    try {
      const response = await fetch(`feature_${index}.html`);
      if (!response.ok) throw new Error('File không tồn tại');
      const text = await response.text();

      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      const h1 = doc.querySelector('h1.text-3xl.font-bold.mb-4');

      if (h1) {
        const fullTitle = h1.textContent.trim();
        // Bỏ số thứ tự và dấu chấm đầu tiên ví dụ: "85. Mã hóa Base64..."
        const title = fullTitle.replace(/^\d+\.\s*/, '');
        return title;
      }
      return `Feature ${index} (Không có tiêu đề)`;
    } catch (e) {
      return `Feature ${index} (Lỗi tải)`;
    }
  }

  // Tải toàn bộ feature và cache
  async function loadFeatures() {
    const promises = [];
    for (let i = 1; i <= totalFeatures; i++) {
      promises.push(
        getFeatureTitle(i).then(title => ({ index: i, title }))
      );
    }
    allFeatures = await Promise.all(promises);
    renderFilteredMenu('');
  }

  // Render menu theo filter tìm kiếm
  function renderFilteredMenu(filter) {
    menuList.innerHTML = '';
    const filtered = allFeatures.filter(f =>
      f.title.toLowerCase().includes(filter.toLowerCase())
    );
    if (filtered.length === 0) {
      menuList.innerHTML = '<p class="text-gray-400 p-2 col-span-full">Không tìm thấy kết quả</p>';
      return;
    }
    filtered.forEach(f => {
      const a = document.createElement('a');
      a.href = `feature_${f.index}.html`;
      a.target = 'featureFrame';
      a.className = "block p-4 bg-gray-700 rounded shadow hover:bg-gray-600 transition cursor-pointer text-white text-sm font-semibold";
      a.textContent = f.title;
      menuList.appendChild(a);
    });
  }

  // Lắng nghe sự kiện tìm kiếm
  searchInput.addEventListener('input', e => {
    renderFilteredMenu(e.target.value);
  });

  // Khởi tạo tải feature khi load trang
  loadFeatures();

</script>

</body>
</html>
